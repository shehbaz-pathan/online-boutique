apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
     name: frontend-virtual-service
spec:
  gateways:
      - public-gateway
  hosts:
      - onlineboutique.example.com
  http:
    - match:
         - headers:
              user-agent:
                    regex: '.*Chrome.*$'
      route:
          - destination:
                host: frontend
                subset: v1
      timeout: 3s
    - match:
         - headers:
             user-agent:
                   regex: '.*Firefox.*$'
      route:
          - destination:
              host: frontend
              subset: v2
      timeout: 3s
    - match:
        - uri: 
            prefix: /
      route:
         - destination:
               host: frontend
               subset: v1
           weight: 50
         - destination:
               host: frontend
               subset: v2
           weight: 50
      timeout: 3s
